{"version":3,"sources":["../../src/components/picker/index.jsx"],"names":["getIndex","list","item","length","index1","findIndex","index2","indexOf","index","Math","max","Error","Picker","props","startY","endY","currentY","itemHeight","selectedIndex","getInitialIndex","state","style","_defaultValue","data","defaultValue","floor","nextProps","isEqual","getReceivePropsIndex","setState","transform","e","preventDefault","nativeEvent","changedTouches","pageY","v","parseInt","value","max1","max2","abs","countListIndex","y","n","setSelectedValue","callback","onChange","getInitialStyle","handleWrapperStart","bind","handleTouchStart","handleTouchMove","handleTouchEnd","map","displayValue","getSelectedClass","Component","propTypes","object","isRequired","func"],"mappings":"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","file":"index.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport _ from 'lodash';\n\nconst getIndex = (list, item) => {\n  if (list && list.length < 1) {\n    return 0;\n  }\n  let index1 = _.findIndex(list, item);\n  let index2 = list.indexOf(item);\n  let index = Math.max(index1, index2);\n  if (index < 0) {\n    throw new Error('list数组中不存在defaultValue');\n  }\n  return index;\n}\n\nclass Picker extends React.Component {\n  constructor(props) {\n    super();\n    this.props = props;\n    this.startY = 0;\n    this.endY   = 0;\n    //当前拖动的Y坐标\n    this.currentY = 0;\n    this.itemHeight = 36;\n    this.selectedIndex = this.getInitialIndex();\n    this.state = {style: {}};\n    this._defaultValue = null;\n  }\n\n  // 初始化获得selectedIndex\n  getInitialIndex() {\n    let index = getIndex(\n      this.props.data.list,\n      this.props.data.defaultValue\n    );\n    if (!this.props.data.defaultValue && this.props.data.list.length > 3) {\n      index = Math.floor(this.props.data.list.length / 2);\n    }\n    return index;\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const isEqual = _.isEqual(\n      nextProps.data.defaultValue,\n      this._defaultValue\n    );\n    if (!isEqual) {\n      this._defaultValue = nextProps.data.defaultValue;\n      this.selectedIndex = this.getReceivePropsIndex(nextProps.data);\n      if (this.selectedIndex === 0) {\n        this.setState({\n          style: {\n            transform: `translate3d(0px, ${this.itemHeight * 2}px, 0px)`\n          }\n        })\n      }\n    }\n  }\n\n  getReceivePropsIndex (data) {\n    if (this._defaultValue) {\n      this.selectedIndex = getIndex(\n        data.list,\n        data.defaultValue\n      );\n    }\n    return this.selectedIndex;\n  }\n\n  getInitialStyle () {\n    this.currentY = 0;\n    if (this.selectedIndex > 2) {\n      this.currentY = - (this.selectedIndex - 2) * this.itemHeight;\n    } else {\n      this.currentY = (2 - this.selectedIndex) * this.itemHeight;\n    }\n    return `translate3d(0px, ${ this.currentY }px, 0px)`;\n  }\n\n  handleTouchStart (e) {\n    e.preventDefault();\n    if (this.props.data.list.length <= 1) {\n      return;\n    }\n    this.startY = e.nativeEvent.changedTouches[0].pageY;\n  }\n\n  handleTouchEnd (e) {\n    e.preventDefault();\n    if (this.props.data.list.length <= 1) {\n      return;\n    }\n    this.endY = e.nativeEvent.changedTouches[0].pageY;\n    // 实际滚动距离\n    let v = parseInt(this.endY - this.startY);\n    let value = v % this.itemHeight;\n    // 计算出每次拖动的36px整倍数\n    this.currentY += (v - value);\n\n    // 正数y最大值\n    const max1 = 2 * this.itemHeight;\n    // 负数y最小值\n    const max2 = (this.props.data.list.length - 3) * this.itemHeight;\n\n    if (this.currentY > max1) {\n      this.currentY = max1;\n    }\n    else if (this.currentY > 0 && this.currentY < max1) {\n      this.currentY = this.currentY;\n    }\n    else if (this.currentY === max1) {\n      this.currentY = this.currentY;\n    }\n    else if (Math.abs(this.currentY) > max2) {\n      this.currentY = - max2;\n    }\n\n    this.countListIndex(this.currentY);\n\n    this.setState({\n      style: {\n        transform: `translate3d(0px, ${ this.currentY }px, 0px)`\n      }\n    });\n  }\n\n  handleTouchMove (e) {\n    e.preventDefault();\n    if (this.props.data.list.length <= 1) {\n      return;\n    }\n    const pageY = e.nativeEvent.changedTouches[0].pageY;\n    let value = parseInt(pageY - this.startY);\n    const y = this.currentY + value;\n    let style = `translate3d(0px, ${ y }px, 0px)`;\n    this.setState({\n      style: {\n        transform: style\n      }\n    });\n  }\n\n  // 计算list数组索引\n  countListIndex (pageY) {\n    let n = pageY / this.itemHeight;\n    n = n > 0 ? 2 - n : Math.abs(n) + 2;\n    this.setSelectedValue(n);\n  }\n\n  // set选中值\n  setSelectedValue (index) {\n    const length = this.props.data.list.length;\n    if (length === 0) {\n      this.callback(null);\n      return;\n    }\n    if (index < 0 || index > length -1) {\n      throw new Error('滑动取值索引数值出现错误'+ index);\n    }\n    const value = this.props.data.list[index];\n    this.selectedIndex = index;\n\n    this.callback(value)\n  }\n\n  // 回调\n  callback (value) {\n    this.props.onChange(value);\n  }\n\n  getSelectedClass (index) {\n    if (this.selectedIndex === index) {\n      return 'ui-picker-item-selected';\n    }\n    return '';\n  }\n\n  componentDidMount () {\n    this.setSelectedValue(this.selectedIndex);\n  }\n\n  handleWrapperStart (e) {\n    e.preventDefault();\n  }\n\n  render () {\n    const style = {\n      transform: this.getInitialStyle()\n    }\n    return (\n      <div className=\"ui-picker-wrapper\" onTouchStart={this.handleWrapperStart.bind(this)}>\n          <div className=\"ui-picker\"\n            style = {this.state.style.transform ? this.state.style : style}\n            onTouchStart={this.handleTouchStart.bind(this)}\n            onTouchMove={this.handleTouchMove.bind(this)}\n            onTouchEnd = {this.handleTouchEnd.bind(this)}>\n            {\n              this.props.data.list.map((data, index) => {\n                const displayValue = this.props.data.displayValue(data);\n                return <div key={index}\n                  className={ 'ui-picker-item ' + this.getSelectedClass(index)}>\n                  {displayValue}\n                </div>\n              })\n            }\n          </div>\n          <div className=\"ui-picker-center\"></div>\n      </div>\n    )\n  }\n}\n\nPicker.propTypes = {\n  // 数据源\n  data: PropTypes.object.isRequired,\n  // 当停止滑动选中立即回调onchange方法\n  onChange: PropTypes.func.isRequired,\n};\n\nexport default Picker;\n"]}